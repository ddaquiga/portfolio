<!DOCTYPE html>

<html lang="en">
<head>
	<title>Darrel Daquigan</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
<div class="container-fluid">
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="home.html">Darrel Daquigan</a>
			</div>
			<ul class="nav navbar-nav">
				<li class="active"><a href="../projects.html">Projects</a></li>
				<li><a href="../resume.html">Resume</a></li>
				<li><a href="../about-me.html">About Me</a></li>
				<li><a href="../contact.html">Contact</a></li>
			</ul>
		</div>
	</nav>
	<div class="row" style="padding-bottom: 50px;">
		<div id="sidebar" class="col-sm-2">
			<ul class="nav nav-pills nav-stacked">
				<li><big>Projects</big></li>
				<li><a href="../projects.html"><strong>Project Index</strong></a></li>
				<li><a href="branch.html">Branch Prediction Simulation</a></li>
				<li><a href="cache.html">Data Cache Simulation</a></li>
				<li><a href="newton.html">Newton's Method Implementaton</a></li>
				<li><a href="pca.html">Principal Component Analysis</a></li>
				<li><a href="disk.html">Disk Performance Analysis</a></li>
				<li><a href="open-server.html">Open Queue Server System Analysis</a></li>
				<li><a href="closed-server.html">Closed Queue Server System Analysis</a></li>
				<li><a href="interactive.html">Interactive and Batch Server System Analysis</a></li>
				<li><a href="interpreter.html">Interpreter/Debugger</a></li>
				<li class="active"><a href="operating-system.html">Custom Operating System Processes</a></li>
				<li><a href="op-overloading.html">Operator Overloading</a></li>
				<li><a href="inheritance.html">Inheritance</a></li>
				<li><a href="tree.html">Binary Tree</a></li>
				<li><a href="graph.html">Graph</a></li>
				<li><big>Site Navigation</big></li>
				<li><a href="resume.html"><strong>Resume</strong></a></li>
				<li><a href="about-me.html"><strong>About Me</strong></a></li>
				<li><a href="contact.html"><strong>Contact</strong></a></li>
			</ul>
		</div>
		<div id="mainbody" class="col-sm-10">
			<h3>Custom Operating System Processes <small>javascript</small></h3>
			<p><big>Operating System Principles - San Francisco State University</big> Spring 2016</p>
			<p>Get Source Code:</p>
			<ul>
				<li>.zip File: <a href="***.zip">Download</a></li>
				<li>git url: <a href="https://github.com/tomassre/cs-415-os-dev.git">https://github.com/tomassre/cs-415-os-dev.git</a></li>
				<li>git SSH key: git@github.com:tomassre/cs-415-os-dev.git</li>
			</ul>
			<p>In this project, I developed the programs, <b>GetInitials</b> and <b>StatsCalc</b> to run on a custom operating system. These programs were formatted to support parallel processing on the operating system. Each process is divided into smaller blocks, which gives the processor convenient places to pause and resume processing. At the end of each block, the process returns callback information telling the operating system where to resume processing. Everytime the process is called, the processor refers to the callback data to know where to resume processing.</p>
			<div class="panel-group">
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">GetInitials</a></p>
					</div>
					<div class="panel-body">
						<div class="panel-group">
							<div class="panel panel-default">
								<div class="panel-heading">
									<p class="panel-title"><a data-toggle="collapse" href="#gi-code-sample">Code Sample: GetInitials.js<span class="caret"></span></a></p>
								</div>
								<div id="gi-code-sample" class="panel-collapse collapse">
									<div class="panel-body">
										<p>This process is broken up into seven segments: get input file length, open input file, read input file, get output file data, open output file, write to output file, and close files. The process can safely pause execution at the end of any of these segments. When reading the input file, the processor will only read 100 characters before pushing the process back into the processor queue. Everytime this happens, the process keeps track of its current position on the file. This way, the process knows where to resume if it is interrupted during a read. The same thing is done when writing the output file. The <i>createInitials</i> function pulls the initials from names in the input file. It is called when getting output file data.</p>
<pre class="pre-scrollable">async.waterfall([
			//get input file length
			function (callback) {
				os.fs.length(inputFile, function (errorLength, length) {
					if (errorLength === -1){
						console.log('initials data: error getting file length: ' +
							os.errno.errorCode + '\n');
						callback('Error');
					}
					else 
						callback(null, length);
				});
			},

			//open input file
			function (length, callback){
				os.fs.open(inputFile, function (errorOpen, fh){
					if (errorOpen === -1) {
						console.log(inputFile + ': error opening file:' +
							errorOpen + '\n');
						callback(errorOpen);
					} else {
						var openMsg = "Opening " + fh.name + " size: " + length;
						stdout.appendToBuffer(openMsg);
						callback(null, length, fh);
					}
				});
			},

			// read input file
			function (length, fh, waterfallCallBack) {
				var CHARS_TO_READ = 100;
				var currentPosition = 0;
				var fullFile = '';

				function checkCompleted() {
					if (currentPosition >= length) 
						waterfallCallBack( null, length, fh, fullFile);
					else
						readNextBlock();
				}
				function readNextBlock() {
					var charCount = currentPosition + CHARS_TO_READ > length ?
						length - currentPosition : CHARS_TO_READ;

					os.fs.read(fh, charCount, function (errorRead, data) {
						if (errorRead === -1){
							console.log(inputFile + ": error reading file: \n");
							waterfallCallBack ('Error Read');
						} else {
							fullFile += data;

							os.fs.seek(fh, charCount, function (errorSeek) {
								if (errorSeek === -1) {
									console.log(inputFile + ": error seeking file:\n");
									waterfallCallBack('Error Seek');
								} else {
									currentPosition += charCount;
									checkCompleted();
								}
							});
						}
					});
				}
				checkCompleted();
			},

			//get output file data
			function (length, fh, fullData, callback) {
				var result = createInitials(fullData);
				var defaulDestination = "newInitials.csv";

				var outputFile; // = "rapper_initials.csv";;

				
				if(argv.length === 2)
					outputFile = argv[1];
				else outputFile = defaulDestination;
				

				stdout.appendToBuffer("Exporting Initials to " + outputFile);

				async.waterfall([
					//open output file
					function (callback) {
						os.fs.create(outputFile, function (errCreate, newFile){
							if (errCreate === -1) {
								console.log("error on create");
								callback("Error");
							} else {
								console.log('Success -------- new file created: ' + 
									newFile + os._internals.fs.disk);
								callback(null, newFile);
							}
						});
					},

					//write to output file
					function (writeTarget, recursivecallback) {
						var fullResult = result;
						var buffer = '';
						var CHARS_TO_WRITE = 5;
						var writeSize = result.length;
						var fileName;
						var writePosition = 0;

						function writeCompleted() {
							if (writePosition >= writeSize) 
								 recursivecallback(null, writeTarget, fileName);
							else
								writeNextBlock();
						}

						function writeNextBlock(){
							var writeEnd;
							if (writePosition + CHARS_TO_WRITE < writeSize)
								writeEnd = writePosition  + CHARS_TO_WRITE;
							else 
								writeEnd = writeSize;
							buffer = fullResult.substring(writePosition,writeEnd);

							os.fs.write(writeTarget, buffer, function (error, fileName) {
								if (error === -1){
									console.log(fileName + ': error writing' + error + '\n');
									callback('Error');
								} else {
									console.log("Write at Position: " + writePosition);
									writePosition = writePosition + CHARS_TO_WRITE;
									writeCompleted();
								}
							});
						}
						writeCompleted();
					},

					//close files
					function (writeTarget,fileName,callback){
						os.fs.close(inputFile, function (errClose, msg){
							if (errClose === -1)
								console.log(msg);
							else
								callback(null);
						});
						os.fs.close(outputFile, function (errClose, msg){
							if (errClose === -1)
								console.log(msg);
							else
								callback(null);
						});

					}
				],

				function (err, writeResult) {
					if (err === -1) 
						console.log('Write Async Block failure');
					else 
						console.log('Write Async Block Success');
				});
			}
		],

		function (error, result) {
			if (error === -1) 
				console.log('GetInitials: ERROR in execution. exited early');
			else {
				stdout.appendToBuffer("Finished");
				console.log('Get Initials Done');
			}
		});
	}

	function createInitials(fullData) {
		var initials = "";
		var initialsArray = fullData.split(",");

		for (var i = 0; i < initialsArray.length; i++){
			initials += initialsArray[i].split(' ').map(
				function (s){
					return s.charAt(0);
				}).join('');
			if ( i !== initialsArray.length -1) initials += ',';
		}
		console.log(initials);
		return initials;
	}</pre>
									</div>
									<div class="panel-footer">
										<p class="text-right"><a data-toggle="collapse" href="#gi-code-sample">Close Dropdown<span class="dropup"><span class="caret"></span></span></a></p>
									</div>
								</div>
							</div>
							<div class="panel panel-default">
								<div class="panel-heading">
									<p class="panel-title"><a data-toggle="collapse" href="#gi-output">Sample Output<span class="caret"></span></a></p>
								</div>
								<div id="gi-output" class="panel-collapse collapse">
									<div class="panel-body">
										<p>Here is a sample of the command line of the operating system. In this sample, I run the <i>GetInitials</i> process on <i>rapper_names.csv</i>, a list of rapper names. I display the files in the filesystem, showing that the <i>GetInitials</i> process created the output file, <i>rapper_initials.csv</i>.</p>
<pre>dummy@OS $ ls
Stats_Data.csv
integers.csv
more_integers.csv
vector_data.csv
Contact_Data.csv
rapper_names.csv
Transaction_Data.csv
dummy@OS $ more rapper_names.csv
Calvin Broadus,Andre Young,O'shea Jackson,Eric Wright,Marshall Mathers,Dwayne Carter,Shawn Carter,James Jackson,Earl Simmons,Antonio Hardy,Krisna Parker,William Griffin,Nasir Jones,Tariq Trotter,Ahmir Thompson,Kamaal Fareed,Malik Taylor,Dante Smith, Talib Greene,Cristopher Bridges,Sean Combs,Christopher Wallace,Trevor Smith,Andre Benjamin, Antwan Patton,Tupac Shakur,William Drayton,Carlton Ridenhour,Adam Horovitz,Michael Diamond,Adam Yauch,Joseph Simmons,Darryl McDaniels,Jason Mizell,Robert Diggs,Gary Grice,Russell Jones,Clifford Smith,Corey Woods,Jason Hunter,Dennis Coles,Jamel Arief,Lamont Hawkins
end of file reached; more process closed
dummy@OS $ man GetInitials
[sourceFile] (optional) [destinationFile] try exec GetInitials rapper_names.csv
dummy@OS $ exec GetInitials rapper_names.csv rapper_initials.csv
Opening rapper_names.csv size: 606
Exporting Initials to rapper_initials.csv
dummy@OS $ ls
Stats_Data.csv
integers.csv
more_integers.csv
vector_data.csv
Contact_Data.csv
rapper_names.csv
Transaction_Data.csv
rapper_initials.csv
dummy@OS $ more rapper_initials.csv
CB,AY,OJ,EW,MM,DC,SC,JJ,ES,AH,KP,WG,NJ,TT,AT,KF,MT,DS,TG,CB,SC,CW,TS,AB,AP,TS,WD,CR,AH,MD,AY,JS,DM,JM,RD,GG,RJ,CS,CW,JH,DC,JA,LH
end of file reached; more process closed</pre>
									</div>
									<div class="panel-footer">
										<p class="text-right"><a data-toggle="collapse" href="#gi-sample-output">Close Dropdown<span class="dropup"><span class="caret"></span></span></a></p>
									</div>
								</div>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">
							<a data-toggle="collapse" href="#stats-calc">StatsCalc<span class="caret"></span></a>
						</p>
					</div>
					<div id="sample-code" class="panel-collapse collapse">
						<div class="panel-body">
							<p>Code Explanation</p>
<pre class="pre-scrollable">	Code Sample
</pre>
						</div>
						<div class="panel-footer">
							<p class="text-right"><a data-toggle="collapse" href="#sample-code">Close dropdown<span class="dropup"><span class="caret"></span></span></a></p>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">
							<a data-toggle="collapse" href="#sample-output">Sample Output: ***<span class="caret"></span></a>
						</p>
					</div>
					<div id="sample-output" class="panel-collapse collapse">
						<div class="panel-body">
							<p>Output Explanation</p>
<pre> Output
</pre>
						</div>
						<div class="panel-footer">
							<p class="text-right"><a data-toggle="collapse" href="#sample-output">close dropdown<span class="dropup"><span class="caret"></span></span></a></p>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>
</body>
</html>

