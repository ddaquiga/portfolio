<!DOCTYPE html>

<html lang="en">
<head>
	<title>Darrel Daquigan</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="../site.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="../animations.js"></script>
</head>

<body id="override-bootstrap">
<nav class="navbar navbar-default">
   <div class="container-fluid">
      <div class="navbar-header">
         <a class="navbar-brand" href="../index.html"><big><b>Darrel Daquigan</b></big></a>
      </div>
      <ul class="nav navbar-nav">
         <li class="active"><a class="nav-item" href="../projects.html">Portfolio</a></li>
         <li><a class="nav-item" href="../resume.html">Resume</a></li>
         <li><a class="nav-item" href="../about-me.html">About Me</a></li>
         <li><a class="nav-item" href="../contact.html">Contact</a></li>
         <li><a class="nav-item" href="../hire-me.php">Hire Me</a></li>
      </ul>
   </div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="sidebar" class="col-sm-2">
			<ul class="nav nav-pills nav-stacked">
				<li><p><big>Projects</big></p></li>
				<li class="active"><a href="branch.html">Branch Prediction Simulation</a></li>
				<li><a href="cache.html">Data Cache Simulation</a></li>
				<li><a href="interpreter.html">Interpreter/ Debugger</a></li>
				<li><a href="disk.html">Disk Performance Analysis</a></li>
				<li><a href="open-server.html">Open Queue Server System Analysis</a></li>
				<li><a href="closed-server.html">Closed Queue Server System Analysis</a></li>
				<li><a href="interactive.html">Interactive and Batch Server System Analysis</a></li>
				<li><a href="op-overloading.html">Operator Overloading</a></li>
				<li><a href="inheritance.html">Inheritance</a></li>
				<li><a href="tree.html">Binary Tree</a></li>
				<li><a href="graph.html">Graph</a></li>
				<li><a href="operating-system.html">Custom Operating System Processes</a></li>
				<li><a href="newton.html">Newton's Method Implementaton</a></li>
				<li><a href="pca.html">Principal Component Analysis</a></li>
				<li><p><big>Site Navigation</big></p></li>
				<li><a href="../index.html"><strong>Home</strong></a></li>
				<li><a href="../projects.html"><strong>Portfolio</strong></a></li>
				<li><a href="../resume.html"><strong>Resume</strong></a></li>
				<li><a href="../about-me.html"><strong>About Me</strong></a></li>
				<li><a href="../contact.html"><strong>Contact</strong></a></li>
			</ul>
		</div>
		<div id="mainbody" class="col-sm-10">
			<h3>Branch Prediction Simulator <small class="language">C++</small></h3>
			<p class="project-data"><big>Computer Organization</big> - San Francisco State University Spring 2017</p>
			<p class="src"><strong>Get Source Code:</strong></p>
			<ul>
				<li>.zip File: <a href="zip_files/DaquiganBranchPrediction.zip">Download</a></li>
				<li>git url: <a href="https://github.com/ddaquiga/Branch-Predictor.git">https://github.com/ddaquiga/Branch-Predictor.git</a></li>
				<li>git SSH key: git@github.com:ddaquiga/Branch-Predictor.git</li>
			</ul>

			<p >In this project I developed two branch prediction simulators. <b>System 1</b> executes a <b>static</b> prediction scheme. Forward branches are predictied not taken, and backward branches are predicted taken. <b>System 2</b> uses a <b>2-bit saturating counter</b> predictor with a branch target buffer where <i>n</i> is the size of the prediction buffer and <i>m</i> is the size of the branch target buffer.
			</p>
			<div class="panel-group">
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">
							<a data-toggle="collapse" href="#results">Results<span class="caret"></span></a>
						</p>
					</div>
					<div id="results" class="panel-collapse collapse">
						<div class="panel-body">
							<p>Here are statistics gathered for three different trace files on three different prediction configurations</p>
					
							<table class="table table-responsive table-hover">
								<thead>
									<tr>
										<th><big>File: test.trace</big></th>
										<th>Mispredictions</th>
										<th>Misprediction Rate</th>
										<th>BTB Misses</th>
										<th>BTB Miss Rate</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>System 1</td>
										<td>6</td>
										<td>0.666667</td>
										<td>-</td>
										<td>-</td>
									</tr>
									<tr>
										<td>System 2 (N=256,M=64)</td>
										<td>7</td>
										<td>0.777778</td>
										<td>0</td>
										<td>0</td>
									</tr>
									<tr>
										<td>System 3 (N=1024,M=256)</td>
										<td>7</td>
										<td>0.777778</td>
										<td>0</td>
										<td>0</td>
									</tr>
								</tbody>
							</table>
							<table class="table table-responsive table-hover">
								<thead>
									<tr>
										<th><big>File: Li1.trace</big></th>
										<th>Mispredictions</th>
										<th>Misprediction Rate</th>
										<th>BTB Misses</th>
										<th>BTB Miss Rate</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>System 1</td>
										<td>29436</td>
										<td>0.4801</td>
										<td>-</td>
										<td>-</td>
									</tr>
									<tr>
										<td>System 2 (N=256,M=64)</td>
										<td>8400</td>
										<td>0.137006</td>
										<td>8187</td>
										<td>0.221408</td>
									</tr>
									<tr>
										<td>System 3 (N=1024,M=256)</td>
										<td>6606</td>
										<td>0.107746</td>
										<td>2290</td>
										<td>0.0615939</td>
									</tr>
								</tbody>
							</table>
							<table class="table table-responsive table-hover">
								<thead>
									<tr>
										<th><big>File: Li2.trace</big></th>
										<th>Mispredictions</th>
										<th>Misprediction Rate</th>
										<th>BTB Misses</th>
										<th>BTB Miss Rate</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>System 1</td>
										<td>34901</td>
										<td>0.537741</td>
										<td>-</td>
										<td>-</td>
									</tr>
									<tr>
										<td>System 2 (N=256,M=64)</td>
										<td>9402</td>
										<td>0.144862</td>
										<td>13146</td>
										<td>0.294252</td>
									</tr>
									<tr>
										<td>System 3 (N=1024,M=256)</td>
										<td>6593</td>
										<td>0.101582</td>
										<td>4000</td>
										<td>0.089672</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="panel-footer">
							<p class="text-right"><a data-toggle="collapse" href="#results">Close Dropdown<span class="dropup"><span class="caret"></span></span></a></p>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">
							<a data-toggle="collapse" href="#sample-code">Sample Code: sys2.cpp<span class="caret"></span></a>
						</p>
					</div>
					<div id="sample-code" class="panel-collapse collapse">
						<div class="panel-body">
							<p>Here is a section of code from <i>sys2.cpp</i>, my dynamic 2-bit branch predictor. First I create the predictor and branch target buffer vectors. The <code>predictor</code> vector holds the current branch prediction for each entry. Each entry of the branch target buffer(<code>btb</code>) holds a tag, a valid bit, and the branch target address. For each line of the given trace file, I extract the indeces and tag by manipulating the bits of the current branch address. Then, I update the entries in <code>predictor</code> and <code>btb</code>. Throughout the loop, I collect various branch and prediction statistics and fill up a stringstream to display if verbose mode is active.</p>
<pre>vector<int> predictor(n,1);
vector< vector<int> > btb(m, vector<int>(3)); // branch target buffer

/*
  btb[i][0] = tag
  btb[i][1] = valid
  btb[i][2] = bta
*/
for (int i = 0; i < m; i++){
  btb[i][0] = -1;
  btb[i][1] = 0;
  btb[i][2] = -1;
}

stringstream verboseStream;
int totalBranches = taken.size();

for (int i = 0; i < totalBranches; i++){
  if (branchType[i] == 1){

    /*
    / splitting up the current branch address to find the correct
    / index for the prediction buffer, index for the branch target
    / buffer, and the tag
    */
    int predictionIndex = (branchAddress[i] >> 2) & (n-1);
    int btbIndex = (branchAddress[i] >> 2) & (m-1);
    int btbTag = branchAddress[i] >> (2 + (int)log2((double)m));

    //  fill the stream if using verbose mode
    if (verbose){
      verboseStream.str(string());
      verboseStream << '\n' << numBranches << ' ';
    }

    //  collect branch statistics
    numBranches++;
    if (branchAddress[i] < branchTarget[i]){
      forward++;
      if (taken[i] == 1){
        forwardTaken++;
      }
    } else {
      backward++;
      if (taken[i] == 1){
        backwardTaken++;
      }
    }


    //fill verbose stream
    if (verbose){
      verboseStream << hex << predictionIndex << ' ' 
        << predictor[predictionIndex] << ' ';
    }


    if (predictor[predictionIndex] > 1){ //predicted taken
      btbAccess++;
      if (btb[btbIndex][1] == 1){ //if valid bit is on

        //  tags don't match, btb miss
        if (btb[btbIndex][0] != btbTag){
          btbMiss++;
        }
      }

      if (taken[i] == 0){
        mispredictions++;
      }
    }
    else{
      if (taken[i] == 1){
        mispredictions++;
      }
    }

    //  update prediction (2-bit saturation counter)
    if (taken[i] == 1){

      if (predictor[predictionIndex] < 3){
        predictor[predictionIndex]++;
      }

      btb[btbIndex][0] = btbTag;      //tag
      btb[btbIndex][1] = 1;       //valid bit
      btb[btbIndex][2] = branchTarget[i]; //branch target address
    }
    else{
      if (predictor[predictionIndex] > 0){
        predictor[predictionIndex]--;
      }
    }


    if (verbose){
      verboseStream << predictor[predictionIndex] << ' '
        << hex << btbIndex << ' ' 
        << hex << btb[btbIndex][0] << ' '
        << btbAccess << ' ' << btbMiss;
      cout << verboseStream.str();
    }

  }
}
</pre>
						</div>
						<div class="panel-footer">
							<p class="text-right"><a data-toggle="collapse" href="#sample-code">Close dropdown<span class="dropup"><span class="caret"></span></span></a></p>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">
							<a data-toggle="collapse" href="#sample-output">Sample Output: sys2.cpp<span class="caret"></span></a>
						</p>
					</div>
					<div id="sample-output" class="panel-collapse collapse">
						<div class="panel-body">
							<p>The <i>sys2</i> program is called on the <i>li2.trace</i> file with a 1024-entry prediction array and a 2048-entry branch target buffer array. The program outputs various branch and prediction data gathered throughout the trace.</p>
<pre>$ ./sys2 li2.trace 1024 2048

Number of branches = 64903
Number of forward branches = 44624
Number of forward taken branches = 29310
Number of backward branches = 20279
Number of backward taken branches = 14688
Number of mispredictions = 6593
Misprediction rate = 0.101582
Number of BTB misses = 210
BTB miss rate = 0.00470778
</pre>
						</div>
						<div class="panel-footer">
							<p class="text-right"><a data-toggle="collapse" href="#sample-output">close dropdown<span class="dropup"><span class="caret"></span></span></a></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="footer" style="position: fixed; left: 0; bottom: 0; width: 100%;">
		<a href="../hire-me.php"><button id="footer-button"type="button" class="btn btn-primary btn-lg btn-block">Hire Me</button></a>
	</div>
</div>
</body>
</html>


						